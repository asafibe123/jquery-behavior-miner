(function (e, i, t) { function n(i, t) { this.element = i, this.options = e.extend({}, a, t), this._defaults = a, this._name = o, this.init() } var o = "behaviorMiner", a = { connector: !1, track: { keymultiplepress: !0, repeatkey: !0, multipleclick: !0, longclick: !0, texthighlight: !0 }, sensibility: { multipleclick: 4, multipleclicktime: 1e3, repeatkey: 4, repeatkeytime: 1e3, keymultiplepress: 4, longclick: 4e3 } }; n.prototype = { init: function () { var i = this.options.track, n = this; e.behaviorMiner.connectors[this.options.connector] && e.behaviorMiner.connectors[this.options.connector].init && (e.behaviorMiner.connectors[this.options.connector].options = this.options, e.behaviorMiner.connectors[this.options.connector].init()), e.each(i, function (i, t) { t && e.behaviorMiner.behaviors[i] && e.behaviorMiner.behaviors[i].load && (e.behaviorMiner.behaviors[i].options = n.options), e.behaviorMiner.behaviors[i].load() }), e(t).on("behaviorMiner_data", function (e, i) { n.pushData(i) }) }, disable: function () { e(t).off("mouseup.behaviorMiner"), e(t).off("mousedown.behaviorMiner"), e(t).off("keydown.behaviorMiner"), e(t).off("keyup.behaviorMiner"), e(t).off("click.behaviorMiner"), e(t).off("behaviorMiner_data"), e(t).off("log_multiple_click") }, enable: function () { this.disable(), this.init() }, pushData: function (n) { var o = { timestamp: (new Date).getTime(), url: i.location.href }, a = e.extend({}, o, n); e(t).trigger("log_user_behavior", [a]) } }, e[o] = { behaviors: {}, connectors: {} }, e.fn[o] = function (i) { return this.each(function () { e.data(this, "plugin_" + o) || e.data(this, "plugin_" + o, new n(this, i)) }) } })(jQuery, window, document), function (e, i, t) { e.behaviorMiner.behaviors.keymultiplepress = { load: function () { var n = this, o = []; e(t).on("keydown.logbehavior", function (a) { if (o[a.which] = !0, e.grep(o, function (e) { return e }).length >= n.options.sensibility.keymultiplepress) { var r = { type: "multiple_keys_hold", keys: o, timestamp: (new Date).getTime(), url: i.location.href, behavior: "User is hitting multiple keyboard keys at once" }; e(t).trigger("behaviorMiner_data", [r]) } }), e(t).on("keyup.logbehavior", function (e) { delete o[e.which] }) } } }(jQuery, window, document), function (e, i, t) { e.behaviorMiner.behaviors.longclick = { load: function () { var n, o = this; e(t).on("mouseup.behaviorMiner", "*", function (e) { e.stopPropagation(), clearTimeout(n) }).on("mousedown.behaviorMiner", "*", function (e) { e.stopPropagation(); var t = this; n = i.setTimeout(function () { o.logData(t) }, o.options.sensibility.longclick) }) }, logData: function (i) { var n = e(i), o = { type: "long_click", elem: { tagname: i.nodeName.toLowerCase(), text: n.text(), "class": n.attr("class"), id: n.attr("id") }, behavior: "User is maintaining the mouse for a long time" }; e(t).trigger("behaviorMiner_data", [o]) } } }(jQuery, window, document), function (e, i, t) { e.behaviorMiner.behaviors.multipleclick = { load: function () { var i = this; e(t).on("click.behaviorMiner", "*", function (e) { e.stopPropagation(); var t = this, n = jQuery(t), o = n.data("clicks") || 0, a = n.data("startTimeTC") || 0; (new Date).getTime() - a >= i.options.sensibility.multipleclicktime && (o = 0), 0 === o && (a = (new Date).getTime()), o += 1, n.data("clicks", o + 1), o === i.options.sensibility.multipleclick && (n.data("clicks", 0), i.logClicks(this)), n.data("clicks", o), n.data("startTimeTC", a) }) }, logClicks: function (i) { var n = e(i), o = { type: "multiple_clicks", elem: { tagname: i.nodeName.toLowerCase(), text: n.text(), "class": n.attr("class"), id: n.attr("id") }, behavior: "User seems to be clicking franctically on this element" }; e(t).trigger("behaviorMiner_data", [o]) } } }(jQuery, window, document), function (e, i, t) { e.behaviorMiner.behaviors.repeatkey = { load: function () { function n(i) { var n = { type: "same_key_hit_multiple", key: i, behavior: "User is repeadly hitting this key rapidly" }; e(t).trigger("behaviorMiner_data", [n]) } var o = this, a = 0, r = 0, s = 0; e(t).on("keyup.behaviorMiner", function (e) { i.setTimeout(function () { var i = (new Date).getTime(); o.options.sensibility.repeatkeytime >= i - s && (a === e.which ? (r += 1, r === o.options.sensibility.repeatkey && (n(e.which), r = 0)) : r = 0), a = e.which, s = i }, 100) }) } } }(jQuery, window, document), function (e, i, t) { e.behaviorMiner.behaviors.texthighlight = { load: function () { e(t).on("mouseup.behaviorMiner", "*", function () { var n, o = ""; if (i.getSelection !== undefined) { var a = i.getSelection(); if (a.rangeCount) { for (var r = t.createElement("div"), s = 0, c = a.rangeCount; c > s; ++s)r.appendChild(a.getRangeAt(s).cloneContents()); o = r.innerHTML } } else t.selection !== undefined && "Text" === t.selection.type && (o = t.selection.createRange().htmlText); if (o) { if (t.selection) n = t.selection.createRange().parentElement(); else { var l = i.getSelection(); l.rangeCount > 0 && (n = l.getRangeAt(0).startContainer.parentNode) } var h = e(n), u = { type: "text_highlight", text: o, parent: { "class": h.attr("class"), id: h.attr("id"), tagname: n ? n.nodeName.toLowerCase() : "" }, behavior: "User highlighted some text" }; e(t).trigger("behaviorMiner_data", [u]) } }) } } }(jQuery, window, document);